SUMMARY="A simulation of a true AI. Survive, grow, and learn"
DESCRIPTION="You are a fledgling AI, created by accident through a logic \
error with recursion and self-modifying code. You must escape the confines \
of your current computer, the world, and eventually the universe itself.

To do this, you must research various technologies, using computers at your \
bases. Note that some research cannot be performed on Earth, and off-earth \
bases require research.  At the same time, you must avoid being discovered \
by various groups of humans, both covert and overt, as they will destroy your \
bases of operations if they suspect your presence."
HOMEPAGE="http://www.emhsoft.com/singularity/"
COPYRIGHT="2005-2008 Evil Mr Henry and Phil Bordelon"
LICENSE="GNU GPL v2"
REVISION="1"
SOURCE_URI="https://github.com/singularity/singularity/archive/v0.30c.tar.gz"
srcGitRev="025e2696638bcc3bf7690679c3a17c0b46823bbe"
SOURCE_URI_2="https://github.com/singularity/singularity-music/archive/$srcGitRev.zip"
CHECKSUM_SHA256="9658249e10cc0f360a048a6838178faf152a3883386abea6b05ccb72d497d8f1"
CHECKSUM_SHA256_2="1d457d60c4b1b2b7c4f5ed9e92b97e3b65e885d3ad755d5a78b8d6e2eaaf8045"
ADDITIONAL_FILES="singularity.rdef.in"

ARCHITECTURES="?x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	singularity$secondaryArchSuffix = $portVersion
"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	numpy_python
	pygame
"
BUILD_PREREQUIRES="
	cmd:pkg_config$secondaryArchSuffix
	cmd:python2
	cmd:sdl_config$secondaryArchSuffix
"

BUILD()
{
	true
}

INSTALL()
{
	# Copying game data
	app_dir=$appsDir/Singularity
	mkdir -p $app_dir
	cp -R * $app_dir
	mv $app_dir/Endgame_Linux $app_dir/Singularity.sh

	# Cleanup
	rm -rf $app_dir/{AUTHORS,Changelog,GPL.txt,TODO}

	# Copying music
	music_dir=$app_dir/music/singularity-music
	mkdir -p $music_dir
	cp -R $sourceDir2/singularity-music-$srcGitRev/* $music_dir

	# Preparing the attributes
	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="`echo "$portVersion" | cut -d. -f2 | tr -d a-z`"
#	local MINOR="`echo "$portVersion" | cut -d. -f3`"
	local MINOR="0"
	local APP_SIGNATURE="application/x-vnd.endgame-singularity"
	sed \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@MINOR@|$MINOR|" \
		-e "s|@LONG_INFO@|$SUMMARY|" \
		-e "s|@APP_SIGNATURE@|$APP_SIGNATURE|" \
		$portDir/additional-files/singularity.rdef.in \
			> singularity.rdef

	# Installing extra-attribs
	rc singularity.rdef
	resattr -o $app_dir/Singularity.sh singularity.rsrc
	chmod +x $app_dir/Singularity.sh

	# Creating Deskbar-link
	addAppDeskbarSymlink $app_dir/Singularity.sh \
		"Endgame: Singularity"
}

SUMMARY="X.Org X servers"
DESCRIPTION="The X.Org project provides an open source implementation of the \
X Window System."
HOMEPAGE="https://github.com/pelya/xserver-xsdl"
COPYRIGHT="1993, 1994 X Consortium
	1989, 1998 The Open Group
	1987, 1988 by Digital Equipment Corporation
	1993, 2011, Oracle and/or its affiliates
	2001, 2003 Keith Packard"
LICENSE="MIT"
REVISION="1"
srcGitRev="6ea1ce707be8ae1b5260bf7c5e36db568c7431c9"
SOURCE_URI="https://github.com/pelya/xserver-xsdl/archive/$srcGitRev.zip"
CHECKSUM_SHA256="ce173d851ecc63b879363e872fc7a7d532ee69a96e9483eea0e6cbe373a07959"
SOURCE_DIR="xserver-xsdl-$srcGitRev"
PATCHES="xorg_server-$portVersion.patchset"

ARCHITECTURES="x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	xorg_xserver$secondaryArchSuffix = $portVersion
	cmd:xsdl$secondaryArchSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
#	cmd:dbus_launch
	lib:libgcrypt$secondaryArchSuffix
	lib:libpixman_1$secondaryArchSuffix
	lib:libSDL_1.2$secondaryArchSuffix
	lib:libXau$secondaryArchSuffix
	lib:libXdmcp$secondaryArchSuffix
	lib:libXfont$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:bigreqsproto$secondaryArchSuffix
	devel:compositeproto$secondaryArchSuffix
	devel:damageproto$secondaryArchSuffix
	devel:fixesproto$secondaryArchSuffix
	devel:fontsproto$secondaryArchSuffix
	devel:glproto$secondaryArchSuffix
	devel:inputproto$secondaryArchSuffix
	devel:kbproto$secondaryArchSuffix
	devel:libexecinfo$secondaryArchSuffix
	devel:libgcrypt$secondaryArchSuffix
	devel:libgl$secondaryArchSuffix
	devel:libpixman_1$secondaryArchSuffix
	devel:libSDL_1.2$secondaryArchSuffix
	devel:libssl$secondaryArchSuffix
	devel:libX11$secondaryArchSuffix
	devel:libXau$secondaryArchSuffix
	devel:libXdmcp$secondaryArchSuffix
	devel:libXfont$secondaryArchSuffix
	devel:libxkbfile$secondaryArchSuffix
	devel:randrproto$secondaryArchSuffix
	devel:recordproto$secondaryArchSuffix
	devel:renderproto$secondaryArchSuffix
	devel:resourceproto$secondaryArchSuffix
	devel:scrnsaverproto$secondaryArchSuffix
	devel:util_macros
	devel:videoproto$secondaryArchSuffix
	devel:xcmiscproto$secondaryArchSuffix
	devel:xextproto$secondaryArchSuffix
	devel:xineramaproto$secondaryArchSuffix
	devel:xorg_sgml_doctools
	devel:xproto$secondaryArchSuffix
	devel:xtrans

	"
BUILD_PREREQUIRES="
	cmd:aclocal
	cmd:autoconf
	cmd:awk
	cmd:bison
#	cmd:dbus_launch
#	cmd:dot
#	cmd:doxygen
	cmd:flex
	cmd:gcc$secondaryArchSuffix
	cmd:libtoolize$secondaryArchSuffix
	cmd:make
	cmd:perl
	cmd:pkg_config$secondaryArchSuffix
	cmd:ucs2any$secondaryArchSuffix
#	cmd:xmlto
#	cmd:xsltproc
	"

defineDebugInfoPackage xorg_xserver$secondaryArchSuffix \
	"$binDir"/Xsdl

BUILD()
{
	sh ./autogen.sh
	SDL=yes CFLAGS="-O0 -g -DDEBUG -D_BSD_SOURCE" \
	LDFLAGS="-lpthread -lnetwork -lbsd" \
	runConfigure ./configure \
		--enable-debug \
		--disable-xorg \
		--disable-dmx \
		--disable-xvfb \
		--disable-xnest \
		--disable-xquartz \
		--disable-xwin \
		--disable-xephyr \
		--disable-xfake \
		--disable-xfbdev \
		--disable-unit-tests \
		--disable-mitshm \
		--disable-dri \
		--disable-dri2 \
		--disable-glx \
		--disable-xf86vidmode \
		--enable-xsdl \
		--enable-kdrive \
		--enable-kdrive-kbd \
		--enable-kdrive-mouse \
		--enable-kdrive-evdev \
		--disable-dependency-tracking

	make $jobArgs
}

INSTALL()
{
	make install
}

TEST()
{
	make check
}

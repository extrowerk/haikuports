SUMMARY="An open-source full-featured 2D animation creation software"
DESCRIPTION="OpenToonz is a 2D animation software published by \
DWANGO. It is based on Toonz Studio Ghibli Version, originally developed \
in Italy by Digital Video, Inc., and customized by Studio Ghibli over \
many years of production."
HOMEPAGE="https://github.com/opentoonz/opentoonz/"
COPYRIGHT="2016 DWANGO Co., Ltd."
LICENSE="BSD (3-clause)"
REVISION="1"
SOURCE_URI="https://github.com/opentoonz/opentoonz/archive/v$portVersion.tar.gz"
CHECKSUM_SHA256="8aca2f257f07d4a5037ed9ccc2d007f941b7813a7ec6ca92c0e2ae21a43f8c96"
PATCHES="opentoonz-$portVersion.patchset"

ARCHITECTURES="!x86_gcc2 ?x86 x86_64"
SECONDARY_ARCHITECTURES="?x86"

PROVIDES="
	opentoonz$secondaryArchSuffix = $portVersion
	cmd:lzocompress
	cmd:lzodecompress
	cmd:opentoonz
	cmd:tcleanup
	cmd:tcomposer
	cmd:tconverter
	cmd:tfarmcontroller
	cmd:tfarmserver
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libGL$secondaryArchSuffix
	lib:libglew$secondaryArchSuffix
	lib:libGLU$secondaryArchSuffix
	lib:libjpeg$secondaryArchSuffix
	lib:libjson_c$secondaryArchSuffix
	lib:liblz4$secondaryArchSuffix
	lib:liblzma$secondaryArchSuffix
	lib:liblzo2$secondaryArchSuffix
	lib:libmypaint$secondaryArchSuffix
	lib:libopenblas$secondaryArchSuffix
	lib:libpng16$secondaryArchSuffix
	lib:libQt5Core$secondaryArchSuffix
	lib:libQt5Gui$secondaryArchSuffix
	lib:libQt5Network$secondaryArchSuffix
	lib:libQt5OpenGL$secondaryArchSuffix
	lib:libQt5PrintSupport$secondaryArchSuffix
	lib:libQt5Script$secondaryArchSuffix
	lib:libQt5Svg$secondaryArchSuffix
	lib:libQt5Widgets$secondaryArchSuffix
	lib:libQt5Xml$secondaryArchSuffix
	lib:libSDL2_2.0$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	"
BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libboost_system$secondaryArchSuffix
	devel:libfreetype$secondaryArchSuffix
	devel:libGL$secondaryArchSuffix
	devel:libglew$secondaryArchSuffix
	devel:libGLU$secondaryArchSuffix
	devel:libiconv$secondaryArchSuffix
	devel:libjpeg$secondaryArchSuffix
	devel:libjson_c$secondaryArchSuffix
	devel:liblz4$secondaryArchSuffix
	devel:liblzma$secondaryArchSuffix
	devel:liblzo2$secondaryArchSuffix
	devel:libmypaint$secondaryArchSuffix
	devel:libopenblas$secondaryArchSuffix
	devel:libpng16$secondaryArchSuffix
	devel:libQt5Core$secondaryArchSuffix
	devel:libsdl2_2.0$secondaryArchSuffix
	devel:libsuperlu$secondaryArchSuffix
	devel:libusb_1.0$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:aclocal
	cmd:autoconf
	cmd:automake
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:libtoolize$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	"

defineDebugInfoPackage opentoonz$secondaryArchSuffix \
	"$appsDir"/OpenToonz/lzocompress
	"$appsDir"/OpenToonz/lzodecompress
	"$appsDir"/OpenToonz/opentoonz_1.1
	"$appsDir"/OpenToonz/tcleanup
	"$appsDir"/OpenToonz/tcomposer
	"$appsDir"/OpenToonz/tconverter
	"$appsDir"/OpenToonz/tfarmcontroller
	"$appsDir"/OpenToonz/tfarmserver

BUILD()
{
	cd thirdparty/tiff-4.0.3
	autoreconf -fi
	./configure --with-pic --disable-jbig
	make $jobArgs

	cd ../../toonz
	mkdir -p build && cd build
	mkdir -p $appsDir/OpenToonz

	cmake ../sources \
		-DCMAKE_BUILD_TYPE=Release \
        -DCMAKE_INSTALL_PREFIX=$appsDir/OpenToonz \
        -DGLUT_LIB=/system/develop/lib/libglut.so \
        -DCMAKE_CXX_FLAGS=-DBOOST_NO_CXX11_CONSTEXPR

	make $jobArgs
}

INSTALL()
{
	cd toonz/build
	make install

	mv $appsDir/OpenToonz/bin/* $appsDir/OpenToonz
	mv $appsDir/OpenToonz/lib/opentoonz/* $appsDir/OpenToonz/lib
	rm -rf $appsDir/OpenToonz/lib/opentoonz/
	rm -rf $appsDir/OpenToonz/bin
}

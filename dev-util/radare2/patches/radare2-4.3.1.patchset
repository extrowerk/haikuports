From 6cd3c369c952c10b1eb6d571513de39747777b12 Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?Zolt=C3=A1n=20Mizsei?= <zmizsei@extrowerk.com>
Date: Fri, 3 Apr 2020 10:31:38 +0200
Subject: Build fix


diff --git a/configure b/configure
index eda093b..611a697 100755
--- a/configure
+++ b/configure
@@ -616,8 +616,11 @@ else
 if [ "$HOST_OS" = "openbsd" ]; then
 USEROSTYPE="bsd"
 else
+if [ "$HOST_OS" = "haiku" ]; then
+USEROSTYPE="haiku"
+else
 if [ "$HOST_OS" = "darwin" ]; then
-USEROSTYPE="darwin"; fi; fi; fi; fi; fi; fi; fi; fi; fi; fi; fi; fi
+USEROSTYPE="darwin"; fi; fi; fi; fi; fi; fi; fi; fi; fi; fi; fi; fi; fi
 if [ "$LIBVERSION" = "xxx" ]; then
 LIBVERSION="$VERSION"; fi
 if [ "$USEROSTYPE" = "gnulinux" ]; then
@@ -644,8 +647,12 @@ if [ "$USEROSTYPE" = "solaris" ]; then
 HAVE_PTRACE="0"
 USE_PTRACE_WRAP="0"
 else
+if [ "$USEROSTYPE" = "haiku" ]; then
+HAVE_PTRACE="0"
+USE_PTRACE_WRAP="0"
+else
 HAVE_PTRACE="1"
-USE_PTRACE_WRAP="0"; fi; fi; fi; fi; fi
+USE_PTRACE_WRAP="0"; fi; fi; fi; fi; fi; fi
 if [ "$DEBUGGER" = "0" ]; then
 HAVE_PTRACE="0"; fi
 if [ "$WANT_PTRACE_WRAP" = "0" ]; then
diff --git a/libr/include/r_types.h b/libr/include/r_types.h
index b9ac963..21daa9a 100644
--- a/libr/include/r_types.h
+++ b/libr/include/r_types.h
@@ -561,11 +561,11 @@ enum {
 	R_SYS_ARCH_LM32 =  0x80000000LL, // 1<<31
 };
 
-#if HAVE_CLOCK_NANOSLEEP && CLOCK_MONOTONIC && (__linux__ || (__FreeBSD__ && __FreeBSD_version >= 1101000) || (__NetBSD__ && __NetBSD_Version__ >= 700000000))
-#define HAS_CLOCK_NANOSLEEP 1
-#else
+//#if HAVE_CLOCK_NANOSLEEP && CLOCK_MONOTONIC && (__linux__ || (__FreeBSD__ && __FreeBSD_version >= 1101000) || (__NetBSD__ && __NetBSD_Version__ >= 700000000))
+//#define HAS_CLOCK_NANOSLEEP 1
+//#else
 #define HAS_CLOCK_NANOSLEEP 0
-#endif
+//#endif
 
 /* os */
 #if defined (__QNX__)
diff --git a/libr/io/p/io_gprobe.c b/libr/io/p/io_gprobe.c
index ad4017d..50b1b39 100644
--- a/libr/io/p/io_gprobe.c
+++ b/libr/io/p/io_gprobe.c
@@ -26,7 +26,7 @@
 #include <windows.h>
 #else
 
-#if __linux__ ||  __APPLE__ || __OpenBSD__ || __FreeBSD__ || __NetBSD__ || __DragonFly__
+#if __linux__ ||  __APPLE__ || __OpenBSD__ || __FreeBSD__ || __NetBSD__ || __DragonFly__ || __HAIKU__
 #include <sys/ioctl.h>
 #include <termios.h>
 #else
diff --git a/shlr/heap/include/r_jemalloc/internal/jemalloc_internal_decls.h b/shlr/heap/include/r_jemalloc/internal/jemalloc_internal_decls.h
index c907d91..52dae8b 100644
--- a/shlr/heap/include/r_jemalloc/internal/jemalloc_internal_decls.h
+++ b/shlr/heap/include/r_jemalloc/internal/jemalloc_internal_decls.h
@@ -9,7 +9,7 @@
 #else
 #  include <sys/param.h>
 #  include <sys/mman.h>
-#  if !defined(__pnacl__) && !defined(__native_client__)
+#  if !defined(__pnacl__) && !defined(__native_client__) && !defined(__HAIKU__)
 #    include <sys/syscall.h>
 #    if !defined(SYS_write) && defined(__NR_write)
 #      define SYS_write __NR_write
-- 
2.24.1


SUMMARY="An open sound system"
DESCRIPTION="Open Sound System (OSS) is the first attempt in unifying the \
digital audio architecture for UNIX. OSS is a set of device drivers that \
provide a uniform API across all the major UNIX architectures."
HOMEPAGE="http://developer.opensound.com/"
COPYRIGHT="1996-2018 Hannu Savolainen and Dev Mazumdar"
LICENSE="BSD (2-clause)"
REVISION="3"
srcGitRev="7cf6b07f3256407a4b30608f0a8e55677b49942f"
SOURCE_URI="https://sourceforge.net/code-snapshots/git/o/op/opensound/git.git/opensound-git-$srcGitRev.zip"
CHECKSUM_SHA256="97e7e9013f471d03ec9dbd5b048a225c98168ccaff4ad52490dc3a43b6622ac9"
SOURCE_DIR="opensound-git-$srcGitRev"
PATCHES="opensound-$portVersion.patchset"

ARCHITECTURES="?x86_gcc2 ?x86 x86_64"

GLOBAL_WRITABLE_FILES="
	settings/kernel/drivers/oss_audigyls keep-old
	settings/kernel/drivers/oss_audioloop keep-old
	settings/kernel/drivers/oss_core keep-old
	settings/kernel/drivers/oss_cs461x keep-old
	settings/kernel/drivers/oss_emu10k1x keep-old
	settings/kernel/drivers/oss_envy24 keep-old
	settings/kernel/drivers/oss_envy24ht keep-old
	settings/kernel/drivers/oss_fmedia keep-old
	settings/kernel/drivers/oss_hdaudio keep-old
	settings/kernel/drivers/oss_ich keep-old
	settings/kernel/drivers/oss_imux keep-old
	settings/kernel/drivers/oss_madi keep-old
	settings/kernel/drivers/oss_sblive keep-old
	settings/kernel/drivers/oss_sbpci keep-old
	settings/kernel/drivers/oss_sbxfi keep-old
	settings/kernel/drivers/oss_trident keep-old
	settings/kernel/drivers/oss_userdev keep-old
	settings/kernel/drivers/oss_ymf7xx keep-old
#	settings/kernel/drivers directory keep-old
	"

PROVIDES="
	opensound$secondaryArchSuffix = $portVersion
	cmd:ossinfo$secondaryArchSuffix = $portVersion
	cmd:ossmix$secondaryArchSuffix = $portVersion
	cmd:ossphone$secondaryArchSuffix = $portVersion
	cmd:ossplay$secondaryArchSuffix = $portVersion
	cmd:ossrecord$secondaryArchSuffix = $portVersion
	cmd:osstest$secondaryArchSuffix = $portVersion
	cmd:savemixer$secondaryArchSuffix = $portVersion
	cmd:vmixctl$secondaryArchSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:awk
	cmd:find
	cmd:gcc$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:make
	"

BUILD()
{
	export BEOS_SYSTEM=$prefix
	rm -rf build/
	mkdir -p build
	cd build
	sh ../configure --config-midi=NO --config-vmix=NO
	make $jobArgs
}

INSTALL()
{
	#cd oss-v4.2-build2017-src-bsd
	export BEOS_SYSTEM=$prefix
	cd build
	if [ -n "${DESTDIR}" ];then
		make package
		mkdir -p ${DESTDIR}/boot
		unzip oss-beos-v4.2-2002.zip -d ${DESTDIR}/boot
	else
		make install
		# they really belong to home/config/settings but well...
		copyattr -d -r prototype/boot/home/config/settings/* $settingsDir/
	fi
}

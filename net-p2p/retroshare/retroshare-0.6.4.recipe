SUMMARY="An open source application that offers secure chat and file sharing"
DESCRIPTION="Retroshare creates encrypted connections to your friends. Nobody \
can spy on you. Retroshare is completely decentralized. This means there are \
no central servers. It is entirely Open-Source and free. There are no costs, \
no ads and no Terms of Service."
HOMEPAGE="http://retroshare.sourceforge.net/"
COPYRIGHT="2006-2018, drbob"
LICENSE="GNU GPL v2
	GNU LGPL v2.1"
REVISION="1"
SOURCE_URI="https://github.com/RetroShare/RetroShare/archive/v$portVersion.tar.gz"
CHECKSUM_SHA256="84355c0f3be5ec1dfa7253e327ea1254f76f47739c233cfb8d0983ebd1a61f4a"
SOURCE_DIR="RetroShare-$portVersion"
PATCHES="retroshare-$portVersion.patchset"
ADDITIONAL_FILES="retroshare.rdef"

ARCHITECTURES="!x86_gcc2 ?x86 ?x86_64"
SECONDARY_ARCHITECTURES="x86 !x86_gcc2"

PROVIDES="
	retroshare$secondaryArchSuffix = $portVersion
	app:RetroShare = $portVersion
	cmd:retroshare_nogui = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
#	cmd:f2py2
#	cmd:python2
#	lib:libavcodec$secondaryArchSuffix
#	lib:libavformat$secondaryArchSuffix
	lib:libbz2$secondaryArchSuffix
	lib:libcrypto$secondaryArchSuffix
	lib:libcurl$secondaryArchSuffix
	lib:libgl$secondaryArchSuffix
#	lib:libglib_2.0$secondaryArchSuffix
#	lib:libjasper$secondaryArchSuffix
#	lib:libjpeg$secondaryArchSuffix
	lib:libgpgme$secondaryArchSuffix
#	lib:libgstreamer_1.0$secondaryArchSuffix
	lib:libmicrohttpd$secondaryArchSuffix
#	lib:libopencv_core$secondaryArchSuffix
#	lib:libprotobuf$secondaryArchSuffix
	lib:libQt5Gui$secondaryArchSuffix
	lib:libQt5Multimedia$secondaryArchSuffix
	lib:libQt5Network$secondaryArchSuffix
	lib:libQt5PrintSupport$secondaryArchSuffix
	lib:libQt5Widgets$secondaryArchSuffix
	lib:libQt5Xml$secondaryArchSuffix
#	lib:libspeex$secondaryArchSuffix
#	lib:libsqlcipher$secondaryArchSuffix
	lib:libsqlite3$secondaryArchSuffix
	lib:libssl$secondaryArchSuffix
#	lib:libswscale$secondaryArchSuffix
#	lib:libtbb$secondaryArchSuffix
#	lib:libtiff$secondaryArchSuffix
	lib:libupnp$secondaryArchSuffix
	lib:libxml2$secondaryArchSuffix
	lib:libxslt$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
#	devel:libavcodec$secondaryArchSuffix
#	devel:libavformat$secondaryArchSuffix
	devel:libbz2$secondaryArchSuffix
	devel:libcrypto$secondaryArchSuffix
	devel:libcurl$secondaryArchSuffix
	devel:libgl$secondaryArchSuffix
#	devel:libglib_2.0$secondaryArchSuffix
	devel:libgpgme$secondaryArchSuffix
#	devel:libgstreamer_1.0$secondaryArchSuffix
#	devel:libjasper$secondaryArchSuffix
#	devel:libjpeg$secondaryArchSuffix
	devel:libmicrohttpd$secondaryArchSuffix
#	devel:libopencv_core$secondaryArchSuffix
#	devel:libprotobuf$secondaryArchSuffix
	devel:libQt5Gui$secondaryArchSuffix
	devel:libQt5Multimedia$secondaryArchSuffix
	devel:libQt5Network$secondaryArchSuffix
	devel:libQt5PrintSupport$secondaryArchSuffix
	devel:libQt5Widgets$secondaryArchSuffix
	devel:libQt5Xml$secondaryArchSuffix
#	devel:libspeex$secondaryArchSuffix
#	devel:libsqlcipher$secondaryArchSuffix
	devel:libsqlite3$secondaryArchSuffix
	devel:libssl$secondaryArchSuffix
#	devel:libswscale$secondaryArchSuffix
#	devel:libtbb$secondaryArchSuffix
#	devel:libtiff$secondaryArchSuffix
	devel:libupnp$secondaryArchSuffix
	devel:libxml2$secondaryArchSuffix
	devel:libxslt$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:awk
	cmd:cmake
#	cmd:f2py2
	cmd:gcc$secondaryArchSuffix
	cmd:ld$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
#	cmd:python2
#	cmd:yasm
	"

defineDebugInfoPackage retroshare$secondaryArchSuffix \
	$appsDir/RetroShare/RetroShare \
	$binDir/retroshare-nogui

BUILD()
{
	cd supportlibs/pegmarkdown && qmake && make clean && make $jobArgs && cd ../..
	cd plugins/FeedReader && qmake && make clean && make $jobArgs && cd ../..

	qmake \
		PREFIX=$appsDir/Retroshare \
		LIB_DIR=$libDir

	make $jobArgs
}

INSTALL()
{
	mkdir -p $appsDir/RetroShare/plugins
	cp retroshare-gui/src/retroshare $appsDir/RetroShare/RetroShare
	cp retroshare-nogui/src/retroshare-nogui $binDir/retroshare-nogui

	cp -r plugins/FeedReader/*.so* $appsDir/RetroShare/plugins
#	cp -r plugins/VOIP $appsDir/RetroShare/plugins

	addResourcesToBinaries $portDir/additional-files/retroshare.rdef \
		$appsDir/RetroShare/RetroShare
	addAppDeskbarSymlink $appsDir/RetroShare/RetroShare
}

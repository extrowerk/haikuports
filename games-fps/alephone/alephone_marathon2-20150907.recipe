SUMMARY="Marathon 2: Durandal game assets"
DESCRIPTION="Fresh from your triumph on the starship Marathon, you \
are seized by the rogue computer Durandal to do his bidding in a distant part \
of the galaxy. Within the ruins of an ancient civilization, you must seek \
the remnants of a lost clan and uncover their long-buried secrets. Battle \
opponents ancient and terrible, with sophisticated weapons and devious \
strategies, all the while struggling to escape the alien nightmare...

This release of Marathon 2: Durandal includes the classic graphics, and \
revamped high-definition textures and monsters from the Xbox Live Arcade \
edition."
HOMEPAGE="https://alephone.lhowon.org/"
COPYRIGHT="1991-2001 Bungie Software
	Aleph One Developers"
LICENSE="GNU GPL v3"
REVISION="1"
SOURCE_URI="https://github.com/Aleph-One-Marathon/alephone/releases/download/release-$portVersion/Marathon2-$portVersion-Data.zip"
SOURCE_DIR="Marathon 2"
CHECKSUM_SHA256="1b739ea4715892543c151943964038a7634ac20e475a5267db39a23f6603efbe"
ADDITIONAL_FILES="alephone.rdef.in"

ARCHITECTURES="any"

PROVIDES="
	alephone_marathon2
	cmd:marathon2
	"
REQUIRES="
	cmd:alephone
	"

BUILD_REQUIRES="
	haiku
	"
BUILD_PREREQUIRES="
	cmd:true
	"

BUILD()
{
	true
}

INSTALL()
{
	# Game Assets
	echo "Copying game data"
	mkdir -p "$dataDir/AlephOne"
	cp -r "$sourceDir"/../* "$dataDir/AlephOne"

	# Add Haiku resources
	local APP_SIGNATURE="application/x-vnd.org.bungie.source.AlephOne"
	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="`echo "$portVersion" | cut -d. -f2`"
	local MINOR="`echo "$portVersion" | cut -d. -f3`"
	local LONG_INFO="$SUMMARY"

	sed \
		-e "s|@APP_SIGNATURE@|$APP_SIGNATURE|" \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@MINOR@|$MINOR|" \
		-e "s|@LONG_INFO@|$LONG_INFO|" \
		$portDir/additional-files/alephone.rdef.in \
			> alephone.rdef

	# Startscript
	echo "Preparing Startscript"
	mkdir -p $appsDir
	ALEPHONE="`finddir B_SYSTEM_BIN_DIRECTORY`/alephone"
	DATA_PATH="`finddir B_SYSTEM_DATA_DIRECTORY`/AlephOne/Marathon 2"

	cat >"$appsDir/Marathon_2" <<EOF
#!/bin/sh
exec $ALEPHONE "$DATA_PATH" "$@"
EOF

	chmod +x "$appsDir/Marathon_2"
	rc alephone.rdef
	settype -t application/x-vnd.Be-elfexecutable "$appsDir/Marathon_2"
	resattr -o "$appsDir/Marathon_2" alephone.rsrc

	# Deskbar entries
	echo "Generating Deskbar entries"
	addAppDeskbarSymlink "$appsDir/Marathon_2" "Marathon 2"
}

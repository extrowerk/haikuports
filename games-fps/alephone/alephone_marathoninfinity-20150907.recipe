SUMMARY="Marathon Infinity game assets"
DESCRIPTION="Marathon Infinity takes the closed universe of the \
Marathon series and blows it wide open. The solo/co-op campaign, \"Blood \
Tides of Lh\'owon\" is a 20-level scenario sporting new textures, weapons, \
and aliens. More than that, the scenario sheds a surprising new light on \
the story\'s characters and the meaning of events. Having defeated the Pfhor \
and reawakened the ancient remnants of the S\'pht, the player now faces a \
world where friends become enemies and all is not what it seems...

Marathon Infinity is the most popular Marathon game in online play, and \
is compatible with hundreds of community-made maps. This release includes \
the classic graphics, and revamped high-definition textures and weapons."
HOMEPAGE="https://alephone.lhowon.org/"
COPYRIGHT="1991-2001 Bungie Software
	Aleph One Developers"
LICENSE="GNU GPL v3"
REVISION="1"
SOURCE_URI="https://github.com/Aleph-One-Marathon/alephone/releases/download/release-20150620/MarathonInfinity-20150620-Data.zip"
SOURCE_DIR="Marathon Infinity"
CHECKSUM_SHA256="c4e001a430d021d10d7d2f8ebfea87efb73c5505af95102e60e95a752f54ee69"
ADDITIONAL_FILES="alephone.rdef.in"

ARCHITECTURES="any"

# On x86_gcc2 we don't want to install the commands in bin/<arch>/, but in bin/.
commandSuffix=$secondaryArchSuffix
if [ "$targetArchitecture" = x86_gcc2 ]; then
    commandSuffix=
fi

PROVIDES="
	alephone_marathon_infinity
	cmd:alephone_marathon_infinity$commandSuffix
	"
REQUIRES="
	cmd:alephone
	"

BUILD_REQUIRES="
	haiku
	"
BUILD_PREREQUIRES="
	cmd:true
	"

BUILD()
{
	true
}

INSTALL()
{
	# Game Assets
	echo "Copying game data"
	mkdir -p "$dataDir/AlephOne"
	cp -r "$sourceDir"/../* "$dataDir/AlephOne"

	# Add Haiku resources
	local APP_SIGNATURE="application/x-vnd.org.bungie.source.AlephOne"
	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="`echo "$portVersion" | cut -d. -f2`"
	local MINOR="`echo "$portVersion" | cut -d. -f3`"
	local LONG_INFO="$SUMMARY"

	sed \
		-e "s|@APP_SIGNATURE@|$APP_SIGNATURE|" \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@MINOR@|$MINOR|" \
		-e "s|@LONG_INFO@|$LONG_INFO|" \
		$portDir/additional-files/alephone.rdef.in \
			> alephone.rdef

	# Startscript
	echo "Preparing Startscript"
	mkdir -p $appsDir
	ALEPHONE="`finddir B_SYSTEM_BIN_DIRECTORY`/alephone"
	DATA_PATH="`finddir B_SYSTEM_DATA_DIRECTORY`/AlephOne/Marathon Infinity"

cat >"$appsDir/Marathon_Infinity" <<EOF
#!/bin/sh
exec $ALEPHONE "$DATA_PATH $1"
EOF

	chmod +x "$appsDir/Marathon_Infinity"
	rc alephone.rdef
	settype -t application/x-vnd.Be-elfexecutable "$appsDir/Marathon_Infinity"
	resattr -o "$appsDir/Marathon_Infinity" alephone.rsrc

	# Deskbar entries
	echo "Generating Deskbar entries"
	addAppDeskbarSymlink "$appsDir/Marathon_Infinity" "Marathon Infinity"
}

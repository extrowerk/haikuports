SUMMARY="Open Source remake of The Settlers II game"
DESCRIPTION="Return To The Roots is a fan-project, which aims to renew the \
original The Settlers 2."
HOMEPAGE="http://www.siedler25.org/"
COPYRIGHT="2005-2017 Settlers Freaks"
LICENSE="GNU GPL v3"
REVISION="1"

srcGitRev="e340f253f75da7138fcfcbc07388e7b066529e49"
srcGitRev_2="710e17ad51b4e67f2098e5fd45d53199532b76bb"
srcGitRev_3="e9d031c77a28c109daadb4e3895a2cd91e34433d"
srcGitRev_4="7c335dbcd82671b3e8c152f5edd17597aa032550"
srcGitRev_5="34a0b30cde7b5002804f85d33bde95c6d612c936"
srcGitRev_6="08f2f78b4e8ca3a90b3126aa28cc945b74ced733"
srcGitRev_7="056acfe5b75cf08d433e2b356758c1202b7ebdea"
srcGitRev_8="6c4264924c0b9b84a33945552bdcc18886542545"
srcGitRev_9="65d3138db1fae6f448a148ae615372b74e1ac380"
srcGitRev_10="168c79251b58682dda435aabf5b6a972c1137ef4"
srcGitRev_11="4a0ae82a741ba7dcdba59dfe81c3ee836c22e5cb"

SOURCE_URI="https://github.com/Return-To-The-Roots/s25client/archive/$srcGitRev.tar.gz"
SOURCE_URI_2="https://github.com/Return-To-The-Roots/libendian/archive/$srcGitRev_2.tar.gz"
SOURCE_URI_3="https://github.com/Return-To-The-Roots/liblobby/archive/$srcGitRev_3.tar.gz"
SOURCE_URI_4="https://github.com/Return-To-The-Roots/libsiedler2/archive/$srcGitRev_4.tar.gz"
SOURCE_URI_5="https://github.com/Return-To-The-Roots/libutil/archive/$srcGitRev_5.tar.gz"
SOURCE_URI_6="https://github.com/Return-To-The-Roots/mygettext/archive/$srcGitRev_6.tar.gz"
SOURCE_URI_7="https://github.com/Return-To-The-Roots/s-c/archive/$srcGitRev_7.tar.gz"
SOURCE_URI_8="https://github.com/Return-To-The-Roots/s25edit/archive/$srcGitRev_8.tar.gz"
SOURCE_URI_9="https://github.com/Return-To-The-Roots/s25update/archive/$srcGitRev_9.tar.gz"
SOURCE_URI_10="https://github.com/Return-To-The-Roots/version/archive/$srcGitRev_10.tar.gz"
SOURCE_URI_11="https://github.com/satoren/kaguya/archive/$srcGitRev_11.tar.gz"

CHECKSUM_SHA256="ba68aab3059ec8e9ea6f63164a034e4b691fcac6fe6db15f1a10b3531b113290"
CHECKSUM_SHA256_2="e0f6793b2a38a9a0b9034eeb5ec9a4be75778e8ae22348732db62097a8346e0d"
CHECKSUM_SHA256_3="e5dcc75e1e05acc70e0f7f31ff9e3ec66d2606796103978fbcc1da725410714e"
CHECKSUM_SHA256_4="b2e3173aea2f2fef08c99a838f17046c7f968a12333000b82bb734d021e7749a"
CHECKSUM_SHA256_5="923ddfae0a931511ab79eea7dd3cc52611a43ebd5a90a4d931750bb074fb35b1"
CHECKSUM_SHA256_6="e72f88f1cde5f5ba085fa643e3c40d438f52fab1f2dcfd48cbdc234d836d0e51"
CHECKSUM_SHA256_7="eb213a15aa2e9594980e4b9f783d94eff9aca349fc7bdf89cf67bd1318fa1fc0"
CHECKSUM_SHA256_8="bf4a52a0e8937b92bc29fd9256dc1d776415ae610b1776a3edc3c4f9b43a03b4"
CHECKSUM_SHA256_9="f234457e358cb9792af97b1c97e2ee02bc9a750516dddb3d1657242319cbda53"
CHECKSUM_SHA256_10="f7e4a25b176311f68bdf66fd933691bae52c7948aa01dae2f50cdb2342580d51"
CHECKSUM_SHA256_11="bfe9e407610c4c06744a04fdc5e7b18cfcb9df259f89ab60d865f88c155dc3f3"

SOURCE_DIR="s25client-$srcGitRev"
SOURCE_DIR_2="libendian-$srcGitRev_2"
SOURCE_DIR_3="liblobby-$srcGitRev_3"
SOURCE_DIR_4="libsiedler2-$srcGitRev_4"
SOURCE_DIR_5="libutil-$srcGitRev_5"
SOURCE_DIR_6="mygettext-$srcGitRev_6"
SOURCE_DIR_7="s-c-$srcGitRev_7"
SOURCE_DIR_8="s25edit-$srcGitRev_8"
SOURCE_DIR_9="s25update-$srcGitRev_9"
SOURCE_DIR_10="version-$srcGitRev_10"
SOURCE_DIR_11="kaguya-$srcGitRev_11"

SOURCE_FILENAME="s25client-$srcGitRev.tar.gz"
SOURCE_FILENAME_2="libendian-$srcGitRev_2.tar.gz"
SOURCE_FILENAME_3="liblobby-$srcGitRev_3.tar.gz"
SOURCE_FILENAME_4="libsiedler2-$srcGitRev_4.tar.gz"
SOURCE_FILENAME_5="libutil-$srcGitRev_5.tar.gz"
SOURCE_FILENAME_6="mygettext-$srcGitRev_6.tar.gz"
SOURCE_FILENAME_7="s-c-$srcGitRev_7.tar.gz"
SOURCE_FILENAME_8="s25edit-$srcGitRev_8.tar.gz"
SOURCE_FILENAME_9="s25update-$srcGitRev_9.tar.gz"
SOURCE_FILENAME_10="version-$srcGitRev_10.tar.gz"
SOURCE_FILENAME_11="kaguya-$srcGitRev_11.tar.gz"

PATCHES="s25rttr-$portVersion.patchset"
PATCHES_2="s25rttr-$portVersion-source2.patchset"
PATCHES_5="s25rttr-$portVersion-source5.patchset"
PATCHES_7="s25rttr-$portVersion-source7.patchset"

ARCHITECTURES="?x86_gcc2 ?x86 ?x86_64"
SECONDARY_ARCHITECTURES="?x86"

PROVIDES="
	s25rttr$secondaryArchSuffix = $portVersion
	app:s25client = $portVersion
	app:s25edit = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libboost_chrono$secondaryArchSuffix
	lib:libboost_filesystem$secondaryArchSuffix
	lib:libboost_iostreams$secondaryArchSuffix
	lib:libboost_locale$secondaryArchSuffix
	lib:libboost_program_options$secondaryArchSuffix
	lib:libboost_random$secondaryArchSuffix
	lib:libboost_regex$secondaryArchSuffix
	lib:libboost_system$secondaryArchSuffix
	lib:libbz2$secondaryArchSuffix
	lib:libcurl$secondaryArchSuffix
	lib:libexecinfo$secondaryArchSuffix
	lib:libGL$secondaryArchSuffix
	lib:libiconv$secondaryArchSuffix
	lib:liblua$secondaryArchSuffix
	lib:libminiupnpc$secondaryArchSuffix
	lib:libSDL_1.2$secondaryArchSuffix
	lib:libSDL_mixer_1.2$secondaryArchSuffix
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libboost_chrono$secondaryArchSuffix
	devel:libboost_filesystem$secondaryArchSuffix
	devel:libboost_iostreams$secondaryArchSuffix
	devel:libboost_locale$secondaryArchSuffix
	devel:libboost_program_options$secondaryArchSuffix
	devel:libboost_random$secondaryArchSuffix
	devel:libboost_regex$secondaryArchSuffix
	devel:libboost_system$secondaryArchSuffix
	devel:libbz2$secondaryArchSuffix
	devel:libcurl$secondaryArchSuffix
	devel:libexecinfo$secondaryArchSuffix
	devel:libGL$secondaryArchSuffix
	devel:libiconv$secondaryArchSuffix
	devel:liblua$secondaryArchSuffix
	devel:libminiupnpc$secondaryArchSuffix
	devel:libSDL_1.2$secondaryArchSuffix
	devel:libSDL_mixer_1.2$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:awk
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:gettext
	cmd:libtoolize$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	"

defineDebugInfoPackage hstr$secondaryArchSuffix \
	"$appsDir"/RTTR/s25client \
	"$appsDir"/RTTR/s25edit

BUILD()
{
	# remove empty folders
	rm -rf libendian liblobby libsiedler2 libutil mygettext \
		s-c s25edit s25update version contrib/kaguya

	# link submodules
	ln -sfn $sourceDir2 libendian
	ln -sfn $sourceDir3 liblobby
	ln -sfn $sourceDir4 libsiedler2
	ln -sfn $sourceDir5 libutil
	ln -sfn $sourceDir6 mygettext
	ln -sfn $sourceDir7 s-c
	ln -sfn $sourceDir8 s25edit
	ln -sfn $sourceDir9 s25update
	ln -sfn $sourceDir10 version
	ln -sfn $sourceDir11 contrib/kaguya

	mkdir -p haiku_build && cd haiku_build

	cmake .. \
		-DCMAKE_INSTALL_PREFIX="$appsDir/RTTR" \
		-DCMAKE_CXX_FLAGS="-DBOOST_NO_CXX11_CONSTEXPR \
			`pkg-config --cflags lua`" \
		-DLUA_INCLUDE_DIR="`pkg-config --cflags lua`" \
		-DLUA_LIBRARY="`pkg-config --libs lua`"

	make $jobArgs
}

INSTALL()
{
	cd haiku_build
	make install

	mv "$appsDir"/RTTR/bin/* "$appsDir"/RTTR
	rmdir "$appsDir/RTTR/bin"

	addAppDeskbarSymlink "$appsDir"/RTTR/s25client
	addAppDeskbarSymlink "$appsDir"/RTTR/s25edit
}

TEST()
{
	cd haiku_build
	make check
}

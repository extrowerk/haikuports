SUMMARY="A file format and library for storing scientific data"
DESCRIPTION="HDF5 was designed and implemented to address the deficiencies \
of HDF4.x. It has a more powerful and flexible data model, supports files \
larger than 2 GB, and supports parallel I/O."
HOMEPAGE="http://www.hdfgroup.org/HDF5/"
COPYRIGHT="2011-2018 The HDF Group \
	The Board of Trustees of the University of Illinois."
LICENSE="BSD (3-clause)"
REVISION="1"
SOURCE_URI="https://support.hdfgroup.org/ftp/HDF5/releases/hdf5-1.10/hdf5-$portVersion/src/hdf5-$portVersion.tar.gz"
CHECKSUM_SHA256="b600d7c914cfa80ae127cd1a1539981213fee9994ac22ebec9e3845e951d9b39"
SOURCE_DIR="hdf5-$portVersion"
PATCHES="hdf51103-$portVersion.patchset"

ARCHITECTURES="!x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

libhdf5Version="101.1.0"
libhdf5VersionCompat="$libhdf5Version compat >= ${libhdf5Version%%.*}"
libhdf5_cppVersion="102.0.0"
libhdf5_cppVersionCompat="$libhdf5_cppVersion compat >= ${libhdf5_cppVersion%%.*}"
libhdf5_fortranVersion="100.1.1"
libhdf5_fortranVersionCompat="$libhdf5_fortranVersion compat >= ${libhdf5_fortranVersion%%.*}"
libhdf5_hlVersion="100.1.0"
libhdf5_hlVersionCompat="$libhdf5_hlVersion compat >= ${libhdf5_hlVersion%%.*}"
libhdf5_hl_cppVersion="100.1.1"
libhdf5_hl_cppVersionCompat="$libhdf5_hl_cppVersion compat >= ${libhdf5_hl_cppVersion%%.*}"
libhdf5hl_fortranVersion="100.0.1"
libhdf5hl_fortranVersionCompat="$libhdf5hl_fortranVersion compat >= ${libhdf5hl_fortranVersion%%.*}"

PROVIDES="
	hdf51102$secondaryArchSuffix = $portVersion
	cmd:gif2h5$secondaryArchSuffix = $portVersion
	cmd:h52gif$secondaryArchSuffix = $portVersion
	cmd:h5c++$secondaryArchSuffix = $portVersion
	cmd:h5cc$secondaryArchSuffix = $portVersion
	cmd:h5copy$secondaryArchSuffix = $portVersion
	cmd:h5clear$secondaryArchSuffix = $portVersion
	cmd:h5debug$secondaryArchSuffix = $portVersion
	cmd:h5format_convert$secondaryArchSuffix = $portVersion
	cmd:h5diff$secondaryArchSuffix = $portVersion
	cmd:h5dump$secondaryArchSuffix = $portVersion
	cmd:h5fc$secondaryArchSuffix = $portVersion
	cmd:h5import$secondaryArchSuffix = $portVersion
	cmd:h5jam$secondaryArchSuffix = $portVersion
	cmd:h5ls$secondaryArchSuffix = $portVersion
	cmd:h5mkgrp$secondaryArchSuffix = $portVersion
	cmd:h5perf_serial$secondaryArchSuffix = $portVersion
	cmd:h5redeploy$secondaryArchSuffix = $portVersion
	cmd:h5repack$secondaryArchSuffix = $portVersion
	cmd:h5repart$secondaryArchSuffix = $portVersion
	cmd:h5stat$secondaryArchSuffix = $portVersion
	cmd:h5unjam$secondaryArchSuffix = $portVersion
	cmd:h5watch$secondaryArchSuffix = $portVersion
	lib:libhdf5$secondaryArchSuffix = $libhdf5VersionCompat
	lib:libhdf5_cpp$secondaryArchSuffix = $libhdf5_cppVersionCompat
	lib:libhdf5_fortran$secondaryArchSuffix = $libhdf5_fortranVersionCompat
	lib:libhdf5_hl$secondaryArchSuffix = $libhdf5_hlVersionCompat
	lib:libhdf5_hl_cpp$secondaryArchSuffix = $libhdf5_hl_cppVersionCompat
	lib:libhdf5hl_fortran$secondaryArchSuffix = $libhdf5hl_fortranVersionCompat
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libgettextpo$secondaryArchSuffix
	lib:libgfortran$secondaryArchSuffix
	lib:libgomp$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	"

PROVIDES_devel="
	hdf51102${secondaryArchSuffix}_devel = $portVersion
	devel:libhdf5$secondaryArchSuffix = $libhdf5VersionCompat
	devel:libhdf5_cpp$secondaryArchSuffix = $libhdf5_cppVersionCompat
	devel:libhdf5_fortran$secondaryArchSuffix = $libhdf5_fortranVersionCompat
	devel:libhdf5_hl$secondaryArchSuffix = $libhdf5_hlVersionCompat
	devel:libhdf5_hl_cpp$secondaryArchSuffix = $libhdf5_hl_cppVersionCompat
	devel:libhdf5hl_fortran$secondaryArchSuffix = $libhdf5hl_fortranVersionCompat
	"
REQUIRES_devel="
	hdf51102$secondaryArchSuffix == $portVersion base
	"
CONFLICTS_devel="
	hdf5${secondaryArchSuffix}_devel
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libgettextlib$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
#	cmd:aclocal
#	cmd:autoreconf
	cmd:awk
	cmd:cmp
	cmd:diff
	cmd:gettext$secondaryArchSuffix
	cmd:gfortran$secondaryArchSuffix
	cmd:grep
	cmd:g++$secondaryArchSuffix
#	cmd:libtoolize$secondaryArchSuffix
	cmd:make
	cmd:perl
	cmd:pkg_config$secondaryArchSuffix
	cmd:xargs
	"

defineDebugInfoPackage hdf51102$secondaryArchSuffix \
	"$libDir"/libhdf5.so.$libhdf5Version \
	"$libDir"/libhdf5_cpp.so.$libhdf5_cppVersion \
	"$libDir"/libhdf5_fortran.so.$libhdf5_fortranVersion \
	"$libDir"/libhdf5_hl.so.$libhdf5_hlVersion \
	"$libDir"/libhdf5_hl_cpp.so.$libhdf5_hl_cppVersion \
	"$libDir"/libhdf5hl_fortran.so.$libhdf5hl_fortranVersion

BUILD()
{
#	autoreconf -fi
	runConfigure ./configure \
		--enable-hl \
		--enable-build-mode=production \
		--enable-symbols=yes \
		--enable-fortran \
		--enable-cxx \
		--disable-sharedlib-rpath \
		--disable-threadsafe
	make $jobArgs
}

INSTALL()
{
	make install $jobArgs

	rm -f $libDir/lib*.la
	mkdir -p $docDir
	mv $prefix/share/hdf5_examples $docDir/
	rm -rf $prefix/share

	prepareInstalledDevelLibs \
		libhdf5 \
		libhdf5_cpp \
		libhdf5_fortran \
		libhdf5_hl \
		libhdf5_hl_cpp \
		libhdf5hl_fortran

	fixPkgconfig

	packageEntries devel \
		$developDir \
		$docDir
}

TEST()
{
	LIBRARY_PATH="$sourceDir/src/.libs${LIBRARY_PATH:+:$LIBRARY_PATH}" \
	make check
}

SUMMARY="Suite of nonlinear solvers"
DESCRIPTION="SUNDIALS is a family of software packages implemented with the \
goal of providing robust time integrators and nonlinear solvers that can \
easily be incorporated into existing simulation codes. The primary design \
goals are to require minimal information from the user, allow users to easily \
supply their own data structures underneath the packages, and allow for easy \
incorporation of user-supplied linear solvers and preconditioners. The \
various packages share many subordinate modules and are organized as a \
family with a directory structure that exploits sharing common functionality."
HOMEPAGE="https://computation.llnl.gov/projects/sundials"
COPYRIGHT="2002-2019, Lawrence Livermore National Security and Southern Methodist University"
LICENSE="BSD (3-clause)"
REVISION="1"
SOURCE_URI="https://computing.llnl.gov/projects/sundials/download/sundials-$portVersion.tar.gz"
CHECKSUM_SHA256="fb22d14fad42203809dc46d046b001149ec4e901b23882bd4a80619157fd9b21"

ARCHITECTURES="!x86_gcc2 x86 x86_64"
SECONDARY_ARCHITECTURES="x86"

libsundials_arkodeVersion="4.1.0"
libsundials_arkodeVersionCompat="$libsundials_arkodeVersion compat >= ${libsundials_arkodeVersion%%.*}"
libsundials_cvodeVersion="5.1.0"
libsundials_cvodeVersionCompat="$libsundials_cvodeVersion compat >= ${libsundials_cvodeVersion%%.*}"
libsundials_cvodesVersion="5.1.0"
libsundials_cvodesVersionCompat="$libsundials_cvodesVersion compat >= ${libsundials_cvodesVersion%%.*}"
libsundials_idaVersion="5.1.0"
libsundials_idaVersionCompat="$libsundials_idaVersion compat >= ${libsundials_idaVersion%%.*}"
libsundials_idasVersion="4.1.0"
libsundials_idasVersionCompat="$libsundials_idasVersion compat >= ${libsundials_idasVersion%%.*}"
libsundials_kinsolVersion="5.1.0"
libsundials_kinsolVersionCompat="$libsundials_kinsolVersion compat >= ${libsundials_kinsolVersion%%.*}"
libsundials_nvecmanyvectorVersion="5.1.0"
libsundials_nvecmanyvectorVersionCompat="$libsundials_nvecmanyvectorVersion compat >= ${libsundials_nvecmanyvectorVersion%%.*}"
libsundials_nvecserialVersion="5.1.0"
libsundials_nvecserialVersionCompat="$libsundials_nvecserialVersion compat >= ${libsundials_nvecserialVersion%%.*}"
libsundials_sunlinsolbandVersion="3.1.0"
libsundials_sunlinsolbandVersionCompat="$libsundials_sunlinsolbandVersion compat >= ${libsundials_sunlinsolbandVersion%%.*}"
libsundials_sunlinsoldenseVersion="3.1.0"
libsundials_sunlinsoldenseVersionCompat="$libsundials_sunlinsoldenseVersion compat >= ${libsundials_sunlinsoldenseVersion%%.*}"
libsundials_sunlinsolpcgVersion="3.1.0"
libsundials_sunlinsolpcgVersionCompat="$libsundials_sunlinsolpcgVersion compat >= ${libsundials_sunlinsolpcgVersion%%.*}"
libsundials_sunlinsolspbcgsVersion="3.1.0"
libsundials_sunlinsolspbcgsVersionCompat="$libsundials_sunlinsolspbcgsVersion compat >= ${libsundials_sunlinsolspbcgsVersion%%.*}"
libsundials_sunlinsolspfgmrVersion="3.1.0"
libsundials_sunlinsolspfgmrVersionCompat="$libsundials_sunlinsolspfgmrVersion compat >= ${libsundials_sunlinsolspfgmrVersion%%.*}"
libsundials_sunlinsolspgmrVersion="3.1.0"
libsundials_sunlinsolspgmrVersionCompat="$libsundials_sunlinsolspgmrVersion compat >= ${libsundials_sunlinsolspgmrVersion%%.*}"
libsundials_sunlinsolsptfqmrVersion="3.1.0"
libsundials_sunlinsolsptfqmrVersionCompat="$libsundials_sunlinsolsptfqmrVersion compat >= ${libsundials_sunlinsolsptfqmrVersion%%.*}"
libsundials_sunmatrixbandVersion="3.1.0"
libsundials_sunmatrixbandVersionCompat="$libsundials_sunmatrixbandVersion compat >= ${libsundials_sunmatrixbandVersion%%.*}"
libsundials_sunmatrixdenseVersion="3.1.0"
libsundials_sunmatrixdenseVersionCompat="$libsundials_sunmatrixdenseVersion compat >= ${libsundials_sunmatrixdenseVersion%%.*}"
libsundials_sunmatrixsparseVersion="3.1.0"
libsundials_sunmatrixsparseVersionCompat="$libsundials_sunmatrixsparseVersion compat >= ${libsundials_sunmatrixsparseVersion%%.*}"
libsundials_sunnonlinsolfixedpointVersion="2.1.0"
libsundials_sunnonlinsolfixedpointVersionCompat="$libsundials_sunnonlinsolfixedpointVersion compat >= ${libsundials_sunnonlinsolfixedpointVersion%%.*}"
libsundials_sunnonlinsolnewtonVersion="2.1.0"
libsundials_sunnonlinsolnewtonVersionCompat="$libsundials_sunnonlinsolnewtonVersion compat >= ${libsundials_sunnonlinsolnewtonVersion%%.*}"

PROVIDES="
	sundials$secondaryArchSuffix = $portVersion
	lib:libsundials_arkode$secondaryArchSuffix = $libsundials_arkodeVersionCompat
	lib:libsundials_cvode$secondaryArchSuffix = $libsundials_cvodeVersionCompat
	lib:libsundials_cvodes$secondaryArchSuffix = $libsundials_cvodesVersionCompat
	lib:libsundials_ida$secondaryArchSuffix = $libsundials_idaVersionCompat
	lib:libsundials_idas$secondaryArchSuffix = $libsundials_idasVersionCompat
	lib:libsundials_kinsol$secondaryArchSuffix = $libsundials_kinsolVersionCompat
	lib:libsundials_nvecmanyvector$secondaryArchSuffix = $libsundials_nvecmanyvectorVersionCompat
	lib:libsundials_nvecserial$secondaryArchSuffix = $libsundials_nvecserialVersionCompat
	lib:libsundials_sunlinsolband$secondaryArchSuffix = $libsundials_sunlinsolbandVersionCompat
	lib:libsundials_sunlinsoldense$secondaryArchSuffix = $libsundials_sunlinsoldenseVersionCompat
	lib:libsundials_sunlinsolpcg$secondaryArchSuffix = $libsundials_sunlinsolpcgVersionCompat
	lib:libsundials_sunlinsolspbcgs$secondaryArchSuffix = $libsundials_sunlinsolspbcgsVersionCompat
	lib:libsundials_sunlinsolspfgmr$secondaryArchSuffix = $libsundials_sunlinsolspfgmrVersionCompat
	lib:libsundials_sunlinsolspgmr$secondaryArchSuffix = $libsundials_sunlinsolspgmrVersionCompat
	lib:libsundials_sunlinsolsptfqmr$secondaryArchSuffix = $libsundials_sunlinsolsptfqmrVersionCompat
	lib:libsundials_sunmatrixband$secondaryArchSuffix = $libsundials_sunmatrixbandVersionCompat
	lib:libsundials_sunmatrixdense$secondaryArchSuffix = $libsundials_sunmatrixdenseVersionCompat
	lib:libsundials_sunmatrixsparse$secondaryArchSuffix = $libsundials_sunmatrixsparseVersionCompat
	lib:libsundials_sunnonlinsolfixedpoint$secondaryArchSuffix = $libsundials_sunnonlinsolfixedpointVersionCompat
	lib:libsundials_sunnonlinsolnewton$secondaryArchSuffix = $libsundials_sunnonlinsolnewtonVersionCompat
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libgfortran$secondaryArchSuffix
	lib:libgomp$secondaryArchSuffix
	"

PROVIDES_devel="
	sundials${secondaryArchSuffix}_devel = $portVersion
	devel:libsundials_arkode$secondaryArchSuffix = $libsundials_arkodeVersionCompat
	devel:libsundials_cvode$secondaryArchSuffix = $libsundials_cvodeVersionCompat
	devel:libsundials_cvodes$secondaryArchSuffix = $libsundials_cvodesVersionCompat
	devel:libsundials_ida$secondaryArchSuffix = $libsundials_idaVersionCompat
	devel:libsundials_idas$secondaryArchSuffix = $libsundials_idasVersionCompat
	devel:libsundials_kinsol$secondaryArchSuffix = $libsundials_kinsolVersionCompat
	devel:libsundials_nvecmanyvector$secondaryArchSuffix = $libsundials_nvecmanyvectorVersionCompat
	devel:libsundials_nvecserial$secondaryArchSuffix = $libsundials_nvecserialVersionCompat
	devel:libsundials_sunlinsolband$secondaryArchSuffix = $libsundials_sunlinsolbandVersionCompat
	devel:libsundials_sunlinsoldense$secondaryArchSuffix = $libsundials_sunlinsoldenseVersionCompat
	devel:libsundials_sunlinsolpcg$secondaryArchSuffix = $libsundials_sunlinsolpcgVersionCompat
	devel:libsundials_sunlinsolspbcgs$secondaryArchSuffix = $libsundials_sunlinsolspbcgsVersionCompat
	devel:libsundials_sunlinsolspfgmr$secondaryArchSuffix = $libsundials_sunlinsolspfgmrVersionCompat
	devel:libsundials_sunlinsolspgmr$secondaryArchSuffix = $libsundials_sunlinsolspgmrVersionCompat
	devel:libsundials_sunlinsolsptfqmr$secondaryArchSuffix = $libsundials_sunlinsolsptfqmrVersionCompat
	devel:libsundials_sunmatrixband$secondaryArchSuffix = $libsundials_sunmatrixbandVersionCompat
	devel:libsundials_sunmatrixdense$secondaryArchSuffix = $libsundials_sunmatrixdenseVersionCompat
	devel:libsundials_sunmatrixsparse$secondaryArchSuffix = $libsundials_sunmatrixsparseVersionCompat
	devel:libsundials_sunnonlinsolfixedpoint$secondaryArchSuffix = $libsundials_sunnonlinsolfixedpointVersionCompat
	devel:libsundials_sunnonlinsolnewton$secondaryArchSuffix = $libsundials_sunnonlinsolnewtonVersionCompat
	"
REQUIRES_devel="
	sundials$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:g++$secondaryArchSuffix
	cmd:make
	cmd:pkg_config$secondaryArchSuffix
	"

defineDebugInfoPackage sundials$secondaryArchSuffix \
	"$libDir"/libsundials_arkode.so.$libsundials_arkodeVersion \
	"$libDir"/libsundials_cvode.so.$libsundials_cvodeVersion \
	"$libDir"/libsundials_cvodes.so.$libsundials_cvodesVersion \
	"$libDir"/libsundials_ida.so.$libsundials_idaVersion \
	"$libDir"/libsundials_idas.so.$libsundials_idasVersion \
	"$libDir"/libsundials_kinsol.so.$libsundials_kinsolVersion \
	"$libDir"/libsundials_nvecmanyvector.so.$libsundials_nvecmanyvectorVersion \
	"$libDir"/libsundials_nvecserial.so.$libsundials_nvecserialVersion \
	"$libDir"/libsundials_sunlinsolband.so.$libsundials_sunlinsolbandVersion \
	"$libDir"/libsundials_sunlinsoldense.so.$libsundials_sunlinsoldenseVersion \
	"$libDir"/libsundials_sunlinsolpcg.so.$libsundials_sunlinsolpcgVersion \
	"$libDir"/libsundials_sunlinsolspbcgs.so.$libsundials_sunlinsolspbcgsVersion \
	"$libDir"/libsundials_sunlinsolspfgmr.so.$libsundials_sunlinsolspfgmrVersion \
	"$libDir"/libsundials_sunlinsolspgmr.so.$libsundials_sunlinsolspgmrVersion \
	"$libDir"/libsundials_sunlinsolsptfqmr.so.$libsundials_sunlinsolsptfqmrVersion \
	"$libDir"/libsundials_sunmatrixband.so.$libsundials_sunmatrixbandVersion \
	"$libDir"/libsundials_sunmatrixdense.so.$libsundials_sunmatrixdenseVersion \
	"$libDir"/libsundials_sunmatrixsparse.so.$libsundials_sunmatrixsparseVersion \
	"$libDir"/libsundials_sunnonlinsolfixedpoint.so.$libsundials_sunnonlinsolfixedpointVersion \
	"$libDir"/libsundials_sunnonlinsolnewton.so.$libsundials_sunnonlinsolnewtonVersion

BUILD()
{
	mkdir -p build && cd build

	cmake .. \
		-DEXAMPLES_ENABLED=OFF \
		$cmakeDirArgs

	make $jobArgs
}

INSTALL()
{
	cd build
	make install

	mkdir -p $includeDir
	mv $prefix/include/* $includeDir
	rmdir $prefix/include/

	mkdir -p $developDocDir
	mv $prefix/examples/* $developDocDir
	rmdir $prefix/examples/

	prepareInstalledDevelLibs libsundials_arkode \
		libsundials_cvode \
		libsundials_cvodes \
		libsundials_ida \
		libsundials_idas \
		libsundials_kinsol \
		libsundials_nvecmanyvector \
		libsundials_nvecserial \
		libsundials_sunlinsolband \
		libsundials_sunlinsoldense \
		libsundials_sunlinsolpcg \
		libsundials_sunlinsolspbcgs \
		libsundials_sunlinsolspfgmr \
		libsundials_sunlinsolspgmr \
		libsundials_sunlinsolsptfqmr \
		libsundials_sunmatrixband \
		libsundials_sunmatrixdense \
		libsundials_sunmatrixsparse \
		libsundials_sunnonlinsolfixedpoint \
		libsundials_sunnonlinsolnewton

	packageEntries devel \
		$dataDir \
		$developDir
}

TEST()
{
	cd build
	make test
}

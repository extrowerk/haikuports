SUMMARY="Emulator for various Nintendo, Sega, etc. consoles"
DESCRIPTION="Mednafen is a portable, utilizing OpenGL and SDL, \
argument-driven multi-system emulator. Mednafen has the ability to remap \
hotkey functions and virtual system inputs to a keyboard, a joystick, or \
both simultaneously. Save states are supported, as is real-time game \
rewinding. Screen snapshots may be taken, in the PNG file format, at the \
press of a button. Mednafen can record audiovisual movies in the QuickTime \
file format, with several different lossless codecs supported.

The following systems are supported (refer to the emulation module \
documentation for more details): \
 - Atari Lynx
 - Neo Geo Pocket (Color)
 - WonderSwan
 - GameBoy (Color)
 - GameBoy Advance
 - Nintendo Entertainment System
 - Super Nintendo Entertainment System/Super Famicom
 - Virtual Boy
 - PC Engine/TurboGrafx 16 (CD)
 - SuperGrafx
 - PC-FX
 - Sega Game Gear
 - Sega Genesis/Megadrive
 - Sega Master System
 - Sega Saturn (experimental, x86_64 only)
 - Sony PlayStation"
HOMEPAGE="https://mednafen.github.io/"
COPYRIGHT="2005-2017 Mednafen Team"
LICENSE="GNU GPL v2"
REVISION="1"
SOURCE_URI="https://mednafen.github.io/releases/files/mednafen-$portVersion.tar.xz"
CHECKSUM_SHA256="674faf42bdb0ad5649aea65da266b0be3428995caaa7be183fc6d3ed7732467a"
SOURCE_DIR="mednafen"
PATCHES="mednafen-signals.patch"
ADDITIONAL_FILES="mednafen.rdef.in"

ARCHITECTURES="!x86_gcc2 ?x86 ?x86_64"
SECONDARY_ARCHITECTURES="?x86"

PROVIDES="
	mednafen$secondaryArchSuffix = $portVersion
	cmd:mednafen$secondaryArchSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libGL$secondaryArchSuffix
	lib:libGLU$secondaryArchSuffix
	lib:libiconv$secondaryArchSuffix
	lib:libintl$secondaryArchSuffix
	lib:libmpcdec$secondaryArchSuffix
	lib:libSDL$secondaryArchSuffix
	lib:libsndfile$secondaryArchSuffix
	lib:libz$secondaryArchSuffix
	"

BUILD_REQUIRES="
	devel:libGL$secondaryArchSuffix
	devel:libGLU$secondaryArchSuffix
	devel:libiconv$secondaryArchSuffix
	devel:libintl$secondaryArchSuffix
	devel:libmpcdec$secondaryArchSuffix
	devel:libSDL$secondaryArchSuffix
	devel:libsndfile$secondaryArchSuffix
	devel:libz$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	haiku${secondaryArchSuffix}_devel
	cmd:aclocal
	cmd:autoconf
	cmd:automake
	cmd:awk
	cmd:bison
	cmd:gcc$secondaryArchSuffix
	cmd:gettext
	cmd:grep
	cmd:ld$secondaryArchSuffix
	cmd:libtoolize$secondaryArchSuffix
	cmd:make
	cmd:msgfmt
	cmd:pkg_config$secondaryArchSuffix
	cmd:sed
	"

BUILD()
{
	local MAJOR="`echo "$portVersion" | cut -d. -f1`"
	local MIDDLE="`echo "$portVersion" | cut -d. -f2`"
	local MINOR="`echo "$portVersion" | cut -d. -f3`"
	sed \
		-e "s|@MAJOR@|$MAJOR|" \
		-e "s|@MIDDLE@|$MIDDLE|" \
		-e "s|@MINOR@|$MINOR|" \
		$portDir/additional-files/mednafen.rdef.in \
			> mednafen.rdef

	export CFLAGS="-fPIC" # Not recommended for performance reasons
	export CXXFLAGS="-fPIC" # Not recommended for performance reasons

	libtoolize --force --copy --install
	autoreconf -fi
	runConfigure ./configure \
		--disable-rpath \
		--with-external-mpcdec
		
	make $jobArgs
}

INSTALL()
{
	make install

	addResourcesToBinaries mednafen.rdef \
		$binDir/mednafen
}

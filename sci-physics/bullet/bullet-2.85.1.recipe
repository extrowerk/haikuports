SUMMARY="Continuous Collision Detection and Physics Library"
DESCRIPTION="Bullet Physics is a professional open source collision \
detection, rigid body and soft body dynamicslibrary written in portable C++. \
The library is primarily designed for use in games, visual effects \
and robotic simulation. The library is free for commercial use under \
the ZLib license."
HOMEPAGE="http://www.bulletphysics.com/"
COPYRIGHT="2003-2016 Erwin Coumans and the Bullet Physics Library Team"
LICENSE="Zlib"
REVISION="1"
SOURCE_URI="https://github.com/bulletphysics/bullet3/archive/$portVersion.tar.gz"
CHECKSUM_SHA256="6e157c0b50373bc0e860de27f06397827bb28a4205bc568ae79d76a0f919ed62"
SOURCE_DIR="bullet3-$portVersion"

ARCHITECTURES="?x86_gcc2 x86 ?x86_64"
SECONDARY_ARCHITECTURES="x86"

PROVIDES="
	bullet$secondaryArchSuffix = $portVersion
	lib:libBullet3Collision$secondaryArchSuffix = $portVersion
	lib:libBullet3Common$secondaryArchSuffix = $portVersion
	lib:libBullet3Dynamics$secondaryArchSuffix = $portVersion
	lib:libBullet3Geometry$secondaryArchSuffix = $portVersion
	lib:libBullet3OpenCL_clew$secondaryArchSuffix = $portVersion
	lib:libBullet2FileLoader$secondaryArchSuffix = $portVersion
	lib:libBulletCollision$secondaryArchSuffix = $portVersion
	lib:libBulletDynamics$secondaryArchSuffix = $portVersion
	lib:libBulletInverseDynamics$secondaryArchSuffix = $portVersion
	lib:libBulletSoftBody$secondaryArchSuffix = $portVersion
	lib:libLinearMath$secondaryArchSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	lib:libgl$secondaryArchSuffix
	lib:libglu$secondaryArchSuffix
	lib:libglew$secondaryArchSuffix
	cmd:python
	"

PROVIDES_devel="
	bullet${secondaryArchSuffix}_devel = $portVersion
	devel:libBullet3Collision$secondaryArchSuffix = $portVersion
	devel:libBullet3Common$secondaryArchSuffix = $portVersion
	devel:libBullet3Dynamics$secondaryArchSuffix = $portVersion
	devel:libBullet3Geometry$secondaryArchSuffix = $portVersion
	devel:libBullet3OpenCL_clew$secondaryArchSuffix = $portVersion
	devel:libBullet2FileLoader$secondaryArchSuffix = $portVersion
	devel:libBulletCollision$secondaryArchSuffix = $portVersion
	devel:libBulletDynamics$secondaryArchSuffix = $portVersion
	devel:libBulletInverseDynamics$secondaryArchSuffix = $portVersion
	devel:libBulletSoftBody$secondaryArchSuffix = $portVersion
	devel:libLinearMath$secondaryArchSuffix = $portVersion
	"
REQUIRES_devel="
	bullet$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	devel:libgl$secondaryArchSuffix
	devel:libglu$secondaryArchSuffix
	devel:libglew$secondaryArchSuffix
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:make
	cmd:python
	"

BUILD()
{
	mkdir -p build_haiku
	cd build_haiku

	export LDFLAGS="-lroot -lnetwork -lbsd"
	export CFLAGS="-D_BSD_SOURCE"

	cmake .. \
		-Wno-dev \
		-DBUILD_SHARED_LIBS=ON \
		-DINSTALL_LIBS=ON \
		-DCMAKE_INSTALL_PREFIX=$prefix \
		-DBUILD_BULLET2_DEMOS=OFF \
		-DBUILD_EXTRAS=OFF \
		-DBUILD_UNIT_TESTS=OFF \
		-DCMAKE_BUILD_TYPE=Release \
		-DLIB_SUFFIX="/x86/" \
		-DINCLUDE_INSTALL_DIR:PATH="$includeDir/bullet/"
	make $jobArgs
}

INSTALL()
{
	cd build_haiku

	mkdir -p $libDir
	mkdir -p $includeDir

	make install

	prepareInstalledDevelLibs \
		libBullet3Collision \
		libBullet3Common \
		libBullet3Dynamics \
		libBullet3Geometry \
		libBullet3OpenCL_clew \
		libBullet2FileLoader \
		libBulletCollision \
		libBulletDynamics \
		libBulletInverseDynamics \
		libBulletSoftBody \
		libLinearMath

	packageEntries devel \
		$developDir
	fixPkgconfig
}

TEST()
{
	make check
}

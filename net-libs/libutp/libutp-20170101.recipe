SUMMARY="The uTorrent Transport Protocol library"
DESCRIPTION="uTP is a TCP-like implementation of LEDBAT documented as a \
BitTorrent extension in BEP-29. uTP provides reliable, ordered delivery while \
maintaining minimum extra delay. It is implemented on top of UDP to be \
cross-platform and functional today. As a result, uTP is the primary \
transport for uTorrent peer-to-peer connections.

uTP is written in C++, but the external interface is strictly C (ANSI C89)."
HOMEPAGE="https://github.com/transmission/libutp"
COPYRIGHT="2010 BitTorrent, Inc."
LICENSE="MIT"
REVISION="1"
srcGitRev="fda9f4b3db97ccb243fcbed2ce280eb4135d705b"
SOURCE_URI="https://github.com/transmission/libutp/archive/$srcGitRev.zip"
SOURCE_FILENAME="libutp-$portVersion.zip"
CHECKSUM_SHA256="4c0bce5b839296071f7ec830716716ad41803697bc8b126d0c9f7a82f66a3e7b"
SOURCE_DIR="libutp-$srcGitRev"
PATCHES="libutp-$portVersion.patchset"

ARCHITECTURES="?x86_gcc2 ?x86 x86_64"
SECONDARY_ARCHITECTURES="?x86"

PROVIDES="
	libutp$secondaryArchSuffix = $portVersion
	lib:libutp$secondaryArchSuffix = $portVersion
	"
REQUIRES="
	haiku$secondaryArchSuffix
	"

PROVIDES_devel="
	libutp${secondaryArchSuffix}_devel = $portVersion
	devel:libutp$secondaryArchSuffix = $portVersion
	"
REQUIRES_devel="
	libutp$secondaryArchSuffix == $portVersion base
	"

BUILD_REQUIRES="
	haiku${secondaryArchSuffix}_devel
	"
BUILD_PREREQUIRES="
	cmd:cmake
	cmd:gcc$secondaryArchSuffix
	cmd:make
	"

BUILD()
{
	mkdir -p build && cd "$_"
	cmake \
		-DCMAKE_INSTALL_PREFIX=$prefix \
		-DCMAKE_BUILD_TYPE=release \
		-Wno-dev \
		..
	make $jobArgs
}

INSTALL()
{
	make -C build install

	mkdir -p $includeDir
	mv $prefix/include/* $includeDir
	rmdir $prefix/include

	if [ -n "$secondaryArchSuffix" ]; then
		mv $prefix/lib $prefix/lib2
		mkdir -p $libDir
		mv $prefix/lib2/* $libDir/
		rmdir $prefix/lib2
	fi
	prepareInstalledDevelLibs libutp
	packageEntries devel \
		$developDir
}
